<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Sources/SourceENS.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/Sources/</a> SourceENS.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/31</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/0</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/31</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
pragma solidity 0.8.15;
&nbsp;
import { Ownable } from "@openzeppelin/contracts/access/Ownable.sol";
import { NameEncoder } from "../libraries/NameEncoder.sol";
import { ISource } from "../interfaces/ISource.sol";
import { IReverseRegistrar } from "../interfaces/ENS/IReverseRegistrar.sol";
import { ITextResolver } from "../interfaces/ENS/ITextResolver.sol";
import { IDefaultReverseResolver } from "../interfaces/ENS/IDefaultReverseResolver.sol";
&nbsp;
contract SourceENS is ISource, Ownable {
  using NameEncoder for string;
&nbsp;
  string[] private _keys;
  address private constant RESOLVER = 0x4976fb03C32e5B8cfe2b6cCB31c09Ba78EBaBa41;
  address private constant REVERSE_REGISTRAR = 0x084b1c3C81545d370f3634392De611CaaBFf8148;
  address private constant DEFAULT_REVERSE_RESOLVER = 0xA2C122BE93b0074270ebeE7f6b7292C7deB45047;
&nbsp;
<span class="fstat-no" title="function not covered" >  constructor() {</span>
<span class="cstat-no" title="statement not covered" >    _keys.push("avatar")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("url")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("description")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("com.github")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("com.twitter")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("org.telegram")</span>;
<span class="cstat-no" title="statement not covered" >    _keys.push("did")</span>;
  }
&nbsp;
  /* ===================================================================================== */
  /* External Functions                                                                    */
  /* ===================================================================================== */
&nbsp;
  /**
   * @notice Get Keys
   * @return keys string[]
   */
<span class="fstat-no" title="function not covered" >  function getKeys() external view returns (string[] memory keys) {</span>
<span class="cstat-no" title="statement not covered" >    return _keys;</span>
  }
&nbsp;
  /**
   * @notice Get data fields count for user
   * @return count uint256
   */
<span class="fstat-no" title="function not covered" >  function count(address user) external view returns (uint256 count) {</span>
<span class="cstat-no" title="statement not covered" >    (, bytes32 node_, ITextResolver res_) = _resolveOwner(user);</span>
<span class="cstat-no" title="statement not covered" >    (string[] memory keys_, ) = _fetchNodeTextFields(_keys, node_, res_);</span>
<span class="cstat-no" title="statement not covered" >    return keys_.length;</span>
  }
&nbsp;
  /**
   * @notice Get all available data for user
   * @param user address
   * @return keys string[]
   * @return values string[]
   */
<span class="fstat-no" title="function not covered" >  function getData(address user)</span>
    external
    view
    returns (string[] memory keys, string[] memory values)
  {
<span class="cstat-no" title="statement not covered" >    (, bytes32 node_, ITextResolver res_) = _resolveOwner(user);</span>
<span class="cstat-no" title="statement not covered" >    (string[] memory keys_, string[] memory values_) = _fetchNodeTextFields(_keys, node_, res_);</span>
<span class="cstat-no" title="statement not covered" >    return (keys_, values_);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function getMetadata(address _address)</span>
    external
    view
    returns (
      bytes32 node,
      string memory name,
      address resolver
    )
  {
<span class="cstat-no" title="statement not covered" >    (string memory name, bytes32 node, ITextResolver resolver) = _resolveOwner(_address);</span>
<span class="cstat-no" title="statement not covered" >    return (node, name, address(resolver));</span>
  }
&nbsp;
  /**
   * @notice Get data value for user
   * @param user address
   * @param key string
   * @return value string
   */
<span class="fstat-no" title="function not covered" >  function getValue(address user, string memory key) external view returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >    (, bytes32 node_, ITextResolver res_) = _resolveOwner(user);</span>
<span class="cstat-no" title="statement not covered" >    return res_.text(node_, key);</span>
  }
&nbsp;
  /**
   * @notice Append Key
   * @param key string
   */
<span class="fstat-no" title="function not covered" >  function appendKey(string calldata key) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >    _keys.push(key)</span>;
  }
&nbsp;
  /**
   * @notice Set Key
   * @param idx uint256
   * @param key string
   */
<span class="fstat-no" title="function not covered" >  function updateKey(uint256 idx, string calldata key) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >    _keys[idx] = key</span>;
  }
&nbsp;
  /* ===================================================================================== */
  /* Internal Functions                                                                    */
  /* ===================================================================================== */
&nbsp;
<span class="fstat-no" title="function not covered" >  function _resolveOwner(address owner_)</span>
    internal
    view
    returns (
      string memory,
      bytes32,
      ITextResolver
    )
  {
<span class="cstat-no" title="statement not covered" >    bytes32 node_ = IReverseRegistrar(REVERSE_REGISTRAR).node(owner_);</span>
<span class="cstat-no" title="statement not covered" >    string memory _name = IDefaultReverseResolver(DEFAULT_REVERSE_RESOLVER).name(node_);</span>
<span class="cstat-no" title="statement not covered" >    (, bytes32 _node) = _name.dnsEncodeName();</span>
<span class="cstat-no" title="statement not covered" >    ITextResolver _resolver = ITextResolver(RESOLVER);</span>
<span class="cstat-no" title="statement not covered" >    return (_name, _node, _resolver);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  function _fetchNodeTextFields(</span>
    string[] memory _traits,
    bytes32 _node,
    ITextResolver _resolver
  ) internal view returns (string[] memory keys_, string[] memory values_) {
<span class="cstat-no" title="statement not covered" >    string[] memory __keys = new string[](_traits.length);</span>
<span class="cstat-no" title="statement not covered" >    string[] memory __values = new string[](_traits.length);</span>
<span class="cstat-no" title="statement not covered" >    for (uint256 i = 0; i &lt; _traits.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >      __keys[i] = _traits[i]</span>;
<span class="cstat-no" title="statement not covered" >      __values[i] = _resolver.text(_node, _traits[i])</span>;
    }
<span class="cstat-no" title="statement not covered" >    return (__keys, __values);</span>
  }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Jul 20 2022 02:57:40 GMT-0600 (Mountain Daylight Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
